<!--doctorsAdvice 医院医嘱-->
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <script src="../js/page/head.js"></script>
   <link rel="stylesheet" href="../css/page/healthForm.css">
   <style>
      .layui-tab-title{
         margin-bottom: 20px;
      }
      .layui-tab-title li{
         font-size: 18px;
      }
   </style>
</head>
<body>
<div class="body-box showLoading">
   <div class="layui-row">
      <div class="layui-col-md8 bmfw_main">
         <div class="title_href">当前位置：<a href="convenientService.html">便民服务</a> >住院医嘱</div>
         <div class="bg_white mar_r pad30">
            <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief" >
               <ul class="layui-tab-title">
                  <li class="layui-this">住院医嘱</li>
                  <li>医嘱明细</li>
               </ul>
               <div class="layui-tab-content">
                  <div class="layui-tab-item layui-show">
                     <ul class="infoUl info_men">
                        <li>
                           <div class="liLabel">医院组织机构代码</div>
                           <div id="orgCode" name="orgCode"></div>
                        </li>
                        <li>
                           <div class="liLabel">医院名称</div>
                           <div id="orgName" name="orgName"></div>
                        </li>
                        <li>
                           <div class="liLabel">姓名</div>
                           <div id="depCode" name="depCode"></div>
                        </li>
                        <li>
                           <div class="liLabel">住院号</div>
                           <div id="depName" name="depName"></div>
                        </li>
                        <li>
                           <div class="liLabel">本次住院标识号</div>
                           <div id="caseNum" name="tcaseNumw"></div>
                        </li>
                        <li>
                           <div class="liLabel">住院次数(次)</div>
                           <div id="sfzh" name="sfzh"></div>
                        </li>
                        <li>
                           <div class="liLabel">住院科别代码</div>
                           <div id="name" name="name"></div>
                        </li>
                        <li>
                           <div class="liLabel">住院科别名称</div>
                           <div id="sex" name="sex"></div>
                        </li>
                        <li>
                           <div class="liLabel">病室</div>
                           <div id="age" name="age"></div>
                        </li>
                        <li>
                           <div class="liLabel">床号</div>
                           <div id="visitingTime" name="visitingTime"></div>
                        </li>
                        <li>
                           <div class="liLabel">个人内码</div>
                           <div id="chiefCompliant" name="chiefCompliant"></div>
                        </li>
                        <li>
                           <div class="liLabel">活动发生时间</div>
                           <div id="presentIllness" name="presentIllness"></div>
                        </li>
                        <li>
                           <div class="liLabel">卡片状态</div>
                           <div id="pastHistory" name="pastHistory"></div>
                        </li>
                        <li>
                           <div class="liLabel">创建时间</div>
                           <div id="physicalExam" name="physicalExam"></div>
                        </li>
                        <li>
                           <div class="liLabel">所属行政区划</div>
                           <div id="treatIdea" name="treatIdea"></div>
                        </li>
                        <li>
                           <div class="liLabel">医嘱类型</div>
                           <div id="doctorName" name="doctorName"></div>
                        </li>
                        <li>
                           <div class="liLabel">身份证件标识</div>
                           <div id="visitingTypeText" name="visitingTypeText"></div>
                        </li>
                        <li>
                           <div class="liLabel">身份证件号码</div>
                           <div id="sfzh1" name="sfzh1"></div>
                        </li>
                        <li>
                           <div class="liLabel">交换类型</div>
                           <div id="sfzh11" name="sfzh11"></div>
                        </li>
                     </ul>
                  </div>
                  <div class="layui-tab-item">
                     <ul class="consUl info_cf">
                        <li class="consLi">
                           <div class="cons-label">医嘱内码</div>
                           <div class="cons-txt" id="outpatientNum" name="outpatientNum">暂无数据</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">序号</div>
                           <div class="cons-txt" id="recipeNum" name="recipeNum">暂无数据</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">医嘱编号</div>
                           <div class="cons-txt" id="prescribeDate" name="prescribeDate">暂无数据</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">医嘱性质</div>
                           <div class="cons-txt" id="recipeType" name="recipeType">暂无数据</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">医嘱内容</div>
                           <div class="cons-txt" id="depName1" name="depName">暂无数据</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">药品分类代码</div>
                           <div class="cons-txt" id="orgName1" name="orgName">暂无数据</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">药物编号/项目编号</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">药物通用名</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">药物名称/项目名称</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">规格</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">单位</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">数量</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">单位剂量</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">医嘱用量</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">用药方式</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">执行频率</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">用药数量</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">药房单位</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">下嘱日期</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">下嘱时间</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">申请天数</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">领用数量</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">执行日期</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">执行时间</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">发药日期</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">停嘱日期</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">停嘱时间</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">状态</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">取消原因</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">取消时间</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">取消医生代码</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">取消医生姓名</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">创建时间</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">所属行政区划</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">交换类型</div>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">医生信息</div>
                        </li>
                        <li class="consLi">
                           <table id="cfmxTable"></table>
                        </li>
                        <li class="consLi">
                           <div class="cons-label">科别</div>
                        </li>
                        <li class="consLi">
                           <table id="cfzdTable"></table>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div class="layui-col-md4">
         <div class="right_height"></div>
         <div class=" bg_white bmfw_main pad20">
            <div class="bm_title">住院医嘱记录</div>
            <ul class="health_list">
            </ul>
            <div id="getPage" class="rightPage"></div>
         </div>
      </div>
   </div>
</div>
<script src="../js/page/foot.js"></script>
<script>
   $(function () {
      layui.use(['laypage','element','table'], function(){
         var layer = layui.layer;
         layer.load();
         var laypage = layui.laypage;
         var element = layui.element;
         var table = layui.table;
         var outDetails = '';
         var mzId = '';
         // 体检记录分页
         var hosPage = {
            elem: 'getPage'
            , count: 100
            , layout: ['prev', 'next']
            , limit: 10  //得到每页显示的条数
            , curr: 1 //得到当前页，以便向服务端请求对应页的数据。
         };
         var jsonParam = {
            sfzh:localStorage.getItem("sfzh"),
            pageNo:'1',
            pageSize:'10'
         };
         //获取列表
         getOutList();
         function getOutList(){
            layer.load();
            getAjax('/region/outpatient/getOutpatientPage',jsonParam,function (resultMsg) {
               hosPage.count = resultMsg.data.count;
               laypage.render(hosPage);
               var html = '';
               if(resultMsg.data.list.length == 0 || resultMsg.data.list == undefined){
                  html += '<li>暂无数据</li>';
               }else{
                  $.each(resultMsg.data.list,function (i, item) {
                     item.num = jsonParam.pageNo*(resultMsg.data.list.length - i);
                     if(item.num < 10){
                        item.num = '0'+item.num
                     }
                     var mzStr = JSON.stringify(item);
                     html+=' <li class="tit_mar clearfix" ids="'+item.id+'">' +
                        '<span class="bg_green font_d health_num fl">'+item.num+'</span>' +
                        '<div class="data_plan fl">' +
                        '<div class="a_gray font_e serialNum">'+item.orgName+'</div>' +
                        '<div class="font_s l_gray fontNum">就诊日期：<span class="jcrq">'+item.visitingTime+'</span></div>' +
                        '</div>' +
                        '</li>'
                  });
               }
               $(".health_list").html(html);
               $(".health_list li").eq(0).find(".serialNum").removeClass("a_gray").addClass("green");
               mzId = $('.health_list li:first-child').attr('ids');
               getOutDetails(mzId);
               getMzzdDetail(mzId);
               getOutCfDetails(mzId);
            });
            layer.closeAll();
            $('.showLoading').css('opacity','1');
         }
         //分页跳转
         hosPage.jump = function (obj) {
            layer.load();
            jsonParam.pageSize = obj.limit;
            jsonParam.pageNo = obj.curr;
            getAjax('/region/outpatient/getOutpatientPage', jsonParam, function (resultMsg) {
               var html ='';
               if(resultMsg.data.list.length == 0 || resultMsg.data.list == undefined){
                  html += '<li>暂无数据</li>'
               }else{
                  $.each(resultMsg.data.list,function (i, item) {
                     item.num = jsonParam.pageNo*(resultMsg.data.list.length - i);
                     if(item.num < 10){
                        item.num = '0'+item.num
                     }
                     var mzStr = JSON.stringify(item);
                     html+=' <li class="tit_mar clearfix" ids="'+item.id+'" details="'+mzStr+'">' +
                        '<span class="bg_green font_d health_num fl">'+item.num+'</span>' +
                        '<div class="data_plan fl">' +
                        '<div class="a_gray font_e serialNum">'+item.orgName+'</div>' +
                        '<div class="font_s l_gray fontNum">评估日期：<span class="jcrq">'+item.visitingTime+'</span></div>' +
                        '</div>' +
                        '</li>'
                  });
                  outDetails = $('.health_list li:first-child').attr('details');
                  mzId = $('.health_list li:first-child').attr('ids');
               }
               $(".health_list").html(html)
            })
            layer.closeAll();
            $('.showLoading').css('opacity','1');
         };
         //获取病历详情
         function getOutDetails(id) {
            layer.load();
            var jsonParam={
               id:id
            };
            getAjax('/region/outpatient/getOutpatientDetail',jsonParam,function (resultMsg) {
               for (var i = 0;i < $('.info_men li').length; i++) {
                  var ids = $('.info_men li').eq(i).find('div').eq(1).attr('id');
                  if(resultMsg.data !== undefined){
                     if(resultMsg.data[ids] != "" && resultMsg.data[ids]){
                        $('#' + ids).html(resultMsg.data[ids])
                     }else{
                        $('#' + ids).html("暂无数据")
                     }
                  }else{
                     $('#' + ids).html("暂无数据")
                  }
               }
            })
            layer.closeAll();
            $('.showLoading').css('opacity','1');
         }
         //获取处方详情
         function getOutCfDetails(id) {
            layer.load();
            var jsonParam2 = {
               mzId:id
            };
            getAjax('/region/outpatient/getOutpatientCfList',jsonParam2,function (resultMsg) {
               for (var i = 0;i < $('.info_cf li').length; i++) {
                  var ids = $('.info_cf li').eq(i).find('div').eq(1).attr('id');
                  if(resultMsg.data[0] !== undefined){
                     if(resultMsg.data[0][ids] != "" && resultMsg.data[0][ids]){
                        $('#' + ids).html(resultMsg.data[0][ids])
                     }else{
                        $('#' + ids).html("暂无数据")
                     }
                     $('#depName1').html((resultMsg.data[0].depName != '' && resultMsg.data[0].depName) ? resultMsg.data[0].depName : '暂无数据');
                     $('#orgName1').html(resultMsg.data[0].orgName != '' && resultMsg.data[0].orgName ? resultMsg.data[0].orgName : '暂无数据');
                     if(resultMsg.data[0].recipeType == '1'){
                        $('#recipeType').html('大病处方')
                     }else if(resultMsg.data[0].recipeType == '2'){
                        $('#recipeType').html('普通处方')
                     }
                  }else{
                     $('#' + ids).html("暂无数据");
                     $('#depName1').html("暂无数据");
                     $('#orgName1').html("暂无数据")
                  }
               }
               //医生信息
               var tablecfmx = {
                  elem: '#cfmxTable',
                  cellMinWidth: 80,
                  even: true,
                  cols: [[
                     {field:'drugClassName', title: '医嘱明细内码',minWidth:120}
                     ,{field:'drugName', title: '医生角色代码',minWidth:120}
                     ,{field:'spec', title: '医生角色',minWidth:120}
                     ,{field:'unit', title: '医生代码',minWidth:120}
                     ,{field:'price', title: '医生姓名',minWidth:120}
                     ,{field:'quantity', title: '创建时间',minWidth:120}
                     ,{field:'drugRoute', title: '所属行政区划',minWidth:120}
                     ,{field:'herbNum', title: '交换类型',minWidth:120}
                  ]],
                  data: []
               };
               table.render(tablecfmx);
               //科别
               var tablecfzd = {
                  elem: '#cfzdTable',
                  cellMinWidth: 120,
                  even: true,
                  cols: [[
                     {field:'diseaseName', title: '医嘱明细内码',minWidth:120}
                     ,{field:'diagnosisType', title: '科别类型',minWidth:120}
                     ,{field:'diagnosisType', title: '科别代码',minWidth:120}
                     ,{field:'diagnosisType', title: '科别名称',minWidth:120}
                     ,{field:'diagnosisType', title: '创建时间',minWidth:120}
                     ,{field:'diagnosisType', title: '所属行政区划',minWidth:120}
                     ,{field:'diagnosisType', title: '交换类型',minWidth:120}
                  ]],
                  data: []
               };
               table.render(tablecfzd);
               if(resultMsg.data[0] !== undefined){
                  tablecfmx.data = resultMsg.data[0].recipelist;
                  table.render(tablecfmx);
                  tablecfzd.data = resultMsg.data[0].diagnosislist;
                  table.render(tablecfzd);
               }
            });
            layer.closeAll();
            $('.showLoading').css('opacity','1');
         }
         //获取门诊诊断
         function getMzzdDetail(id){
            layer.load();
            var jsonParam2 = {
               mzId:id
            };
            getAjax('/region/outpatient/getOutpatientZDList',jsonParam2,function (resultMsg) {
               // 科别
               var tablemzzd = {
                  elem: '#mzzdTable',
                  cellMinWidth: 120,
                  even: true,
                  cols: [[
                     {field:'diseaseName', title: '医嘱明细内码'}
                     ,{field:'diagnosisTime', title: '医生角色代码'}
                     ,{field:'diagnosisTime', title: '医生角色'}
                     ,{field:'diagnosisTime', title: '医生代码'}
                     ,{field:'diagnosisTime', title: '医生姓名'}
                     ,{field:'diagnosisTime', title: '创建时间'}
                     ,{field:'diagnosisTime', title: '所属行政区划'}
                     ,{field:'diagnosisTime', title: '交换类型'}
                  ]],
                  data: []
               };
               table.render(tablemzzd);
               if(resultMsg.data){
                  tablemzzd.data = resultMsg.data;
                  table.render(tablemzzd);
               }
               // 医生信息
               var tableys = {
                  elem: '#ysxxTable',
                  cellMinWidth: 120,
                  even: true,
                  cols: [[
                     {field:'diseaseName', title: '医嘱明细内码'}
                     ,{field:'diagnosisTime', title: '科别类型'}
                     ,{field:'diagnosisTime', title: '科别代码'}
                     ,{field:'diagnosisTime', title: '科别名称'}
                     ,{field:'diagnosisTime', title: '创建时间'}
                     ,{field:'diagnosisTime', title: '所属行政区划'}
                     ,{field:'diagnosisTime', title: '交换类型'}
                  ]],
                  data: []
               };
               table.render(tableys);
               if(resultMsg.data){
                  tableys.data = resultMsg.data;
                  table.render(tableys);
               }
            })
            layer.closeAll();
            $('.showLoading').css('opacity','1');
         }
         $(".health_list").on("click","li",function () {
            $(this).find(".serialNum").removeClass("a_gray").addClass("green");
            $(this).siblings().find(".serialNum").removeClass("green").addClass("a_gray");
            mzId = $(this).attr("ids");
            getOutDetails(mzId);
            getOutCfDetails(mzId);
            getMzzdDetail(mzId)
         });
      })
   })
</script>
</body>
</html>