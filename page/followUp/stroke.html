<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>脑卒中随访记录表</title>
    <script src="../../js/page/commen.js"></script>
</head>
<body>
<div class="layui-row sfContainer showLoading">
    <div class="layui-col-xs8 layui-col-md8 bmfw_main bg_white pad30">
       <div class="sfNo">暂无数据</div>
       <div class="sfBox">
           <div class="top_box">
               <div class="top_title">脑卒中随访记录表</div>
               <div class="l_gray">随访日期：<span class="mar_r">2020-02-29</span><span class="green mar_r">随访方式：门诊</span>随访医生：李大夫</div>
           </div>
           <ul class="consUl">
               <li class="consLi">
                   <div class="cons-label">随访日期</div>
                   <div class="cons-txt sfz" id="followupdate" name="followupdate"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">随访方式</div>
                   <div class="cons-txt sfz" id="followupwayName" name="followupwayName"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">症状</div>
                   <div class="cons-txt sfz" id="symptomName" name="symptomName"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">其他</div>
                   <div class="cons-txt sfz" id="symptomother" name="symptomother"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">体征</div>
                   <div class="cons-txt tizheng">
                       <div style="">
                           <span class="span-label">血压(mmHg)</span>
                           <span id="hypertension" name="hypertension" class="sfz"></span>/
                           <span id="hypotension" name="hypotension" class="sfz"></span>
                       </div>
                       <div>
                           <span class="span-label">体重(kg)</span>
                           <span id="weight" name="weight" class="sfz"></span>
                       </div>
                       <div>
                           <span class="span-label">其他体征</span>
                           <span id="signother" name="signother" class="sfz"></span>
                       </div>
                   </div>
               </li>
               <li class="consLi">
                   <div class="cons-label">服用何种药物防治</div>
                   <div class="cons-txt sfz" id="drugcontrol" name="drugcontrol"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">饮酒注意事项</div>
                   <div class="cons-txt sfz" id="smokedrinkattention" name="smokedrinkattention"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">运动注意事项</div>
                   <div class="cons-txt sfz" id="sportattention" name="sportattention"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">摄盐注意事项</div>
                   <div class="cons-txt sfz" id="eatsaltattention" name="eatsaltattention"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">心理调整</div>
                   <div class="cons-txt sfz" id="psychicadjustName" name="psychicadjustName"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">遵医行为</div>
                   <div class="cons-txt sfz" id="obeydoctorbehavioName" name="obeydoctorbehavioName"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">辅助检查</div>
                   <div class="cons-txt sfz" id="assistantexam" name="assistantexam"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">服药依从性</div>
                   <div class="cons-txt sfz" id="medicationcomplianceName" name="medicationcomplianceName"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">药物不良反应</div>
                   <div class="cons-txt">
                       <span class="sfz" id="adrName"></span>
                       <span class="sfz" id="adrex"></span>
                   </div>
               </li>
               <li class="consLi">
                   <div class="cons-label">此次随访分类</div>
                   <div class="cons-txt sfz" id="followuptypeName" name="followuptypeName"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">目前用药</div>
                   <div class="cons-txt">
   <!--                    <table id="mqyyTable"></table>-->
                       <table class="my-table" id="yaowutable">
                           <thead>
                           <tr class="bgtr">
                               <th>药物名称</th>
                               <th>用药频次</th>
                               <th>单次剂量</th>
                           </tr>
                           </thead>
                           <tbody></tbody>
                       </table>
                       <div class="table-nodata">暂无数据</div>
   <!--                    <table class="my-table-table">-->
   <!--                        <thead>-->
   <!--                        <tr class="bgtr">-->
   <!--                            <th>药物名称</th>-->
   <!--                            <th>用药频次</th>-->
   <!--                            <th>单次剂量(mg)</th>-->
   <!--                        </tr>-->
   <!--                        </thead>-->
   <!--                        <tbody>-->
   <!--                        <tr>-->
   <!--                            <td class="sfz" id="ywmc1"></td>-->
   <!--                            <td class="sfz" id="ywmc1ci"></td>-->
   <!--                            <td class="sfz" id="ywmc1mg"></td>-->
   <!--                        </tr>-->
   <!--                        <tr>-->
   <!--                            <td class="sfz" id="ywmc2"></td>-->
   <!--                            <td class="sfz" id="ywmc2ci"></td>-->
   <!--                            <td class="sfz" id="ywmc2mg"></td>-->
   <!--                        </tr>-->
   <!--                        <tr>-->
   <!--                            <td class="sfz" id="ywmc3"></td>-->
   <!--                            <td class="sfz" id="ywmc3ci"></td>-->
   <!--                            <td class="sfz" id="ywmc3mg"></td>-->
   <!--                        </tr>-->
   <!--                        </tbody>-->
   <!--                    </table>-->
                   </div>
               </li>
               <li class="consLi">
                   <div class="cons-label">转诊原因</div>
                   <div class="cons-txt sfz" id="referralreason" name="referralreason"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">转诊机构及科室</div>
                   <div class="cons-txt sfz" id="referralorg" name="referralorg"></div>
               </li>
               <li class="consLi">
                   <div class="cons-label">随访照片</div>
                   <div class="cons-txt">
                       <div class="consPic">
                           <div><img src="../../img/noload.png"></div>
                       </div>
                   </div>
               </li>
               <li class="consLi">
                   <div class="cons-label">医生签字</div>
                   <div class="cons-txt">
                       <div class="consQianm">
                           <div>医生未上传手写签名</div>
                       </div>
                   </div>
               </li>
               <li class="consLi">
                   <div class="cons-label">下次随访日期</div>
                   <div class="cons-txt sfz" id="nextfollowupdate" name="nextfollowupdate"></div>
               </li>
           </ul>
       </div>
    </div>
    <div class="layui-col-xs4 layui-col-md4">
        <div class="bg_white bmfw_main pad30 rightBox" style="margin-left: 30px">
            <div class="bm_title"><div class="hetBox">随访记录</div> <div class="date_r hetBox font_s gray">
                <input type="text" class="layui-input" id="getDate"><i class="iconfont icon-tubiaozhizuo- iconJ"></i>
            </div></div>
            <!--<div class="bm_title">随访记录 <div><span><input type="text" class="layui-input" id="year" placeholder="yyyy"></span></div></div>-->
            <ul class="health_list">
                <li class="myFlex tit_mar">
                    <span class="bg_lightgreen font_d health_num">03</span>
                    <div class="data_plan">
                        <div class="green font_e serialNum">脑卒中随访  </div>
                        <div class="font_s l_gray">随访日期：2019-10-10</div>
                    </div>
                </li>
            </ul>
            <div id="getPage" class="rightPage"></div>
        </div>
    </div>
</div>
</body>
<script>
    $(function(){
        layui.use(['laydate', 'laypage', 'layer', 'table'], function() {
            var laydate = layui.laydate;
            var table = layui.table;
            var laypage = layui.laypage
                ,layer = layui.layer;
           var hosPage = {
                elem: 'getPage'
                , count: 100
                , layout: ['prev', 'next']
                , limit: 10  //得到每页显示的条数
                , curr: 1 //得到当前页，以便向服务端请求对应页的数据。
                , jump: function (obj) {
                }
            };
            var myDate = new Date();
            $("#getDate").val(myDate.getFullYear());
            //年选择器
            // lay('#getDate').on('click', function(e) { //假设 test1 是一个按钮
            $("#getDate").click(function () {
                $(".iconJ").addClass("iconTrans")
            });
            laydate.render({
                elem: '#getDate',
                type: 'year',
                btns: ['now','confirm'],
                max: getNowFormatDate(),
                done: function (value, dates, edate) {
                    $(".iconJ").removeClass("iconTrans");
                    jsonParam.searchTime = value;
                    getList()
                }
            });
            function getNowFormatDate() {
                var date = new Date();
                var seperator1 = "-";
                var seperator2 = ":";
                var month = date.getMonth() + 1;
                var strDate = date.getDate();
                if (month >= 1 && month <= 9) {
                    month = "0" + month;
                }
                if (strDate >= 0 && strDate <= 9) {
                    strDate = "0" + strDate;
                }
                var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
                    + " " + date.getHours() + seperator2 + date.getMinutes()
                    + seperator2 + date.getSeconds();
                return currentdate;
            }
            // 记录
            var jsonParam = {
                // sfzh: '370784201812244056',
                sfzh: localStorage.getItem("sfzh"),
                jmid:localStorage.getItem('jmid'),
                pageNo: 1,
                pageSize :10,
                searchTime: $("#getDate").val()
            }
            $(".health_list").on("click","li",function () {
                $(this).find(".serialNum").removeClass("a_gray").addClass("green")
                $(this).siblings().find(".serialNum").removeClass("green").addClass("a_gray")
                getDetails($(this).attr("ids"))
            })
            getList()
            function getList() {
                getAjax('/health/follow/getNczList', jsonParam, function (resultMsg) {
                   layui.layer.closeAll()
                   $(".showLoading").css("opacity",'1')
                    hosPage.count = resultMsg.data.count;
                    laypage.render(hosPage);
                    var html = ''
                   if(resultMsg.data.count == '0'){
                      html += '<li>暂无数据</li>';
                      $(".health_list").html(html);
                      $(".sfBox").hide();
                      $(".sfNo").show();
                   }else{
                      $(".sfBox").show();
                      $(".sfNo").hide();
                         $.each(resultMsg.data.list, function (i, item) {
                            item.num = jsonParam.pageNo * (resultMsg.data.list.length - i)
                            if (item.num < 10) {
                               item.num = '0' + item.num
                            }
                            html+='<li class="myFlex tit_mar" ids="'+item.id+'">' +
                               '<span class="bg_lightgreen font_d health_num">'+item.num+'</span>' +
                               '<div class="data_plan">' +
                               '<div class="green font_e serialNum">脑卒中随访</div>' +
                               '<div class="font_s l_gray">随访日期：'+item.sfrq+'</div>' +
                               '</div>' +
                               '</li>'
                         })
                         getDetails(resultMsg.data.list[0].id)
                    $(".health_list").html(html)
                    $(".health_list li").eq(0).find(".serialNum").removeClass("a_gray").addClass("green");
                  }
                })
            }
            hosPage.jump = function (obj) {
                jsonParam.pageSize = obj.limit;
                jsonParam.pageNo = obj.curr;
                getAjax('/health/follow/getNczList', jsonParam, function (resultMsg) {
                    var html =''
                   if(resultMsg.data.count == '0'){
                      html += '<li>暂无数据</li>';
                      $(".health_list").html(html);
                      $(".sfBox").hide();
                      $(".sfNo").show();
                   }else{
                      $(".sfBox").show();
                      $(".sfNo").hide();
                      $.each(resultMsg.data.list, function (i, item) {
                         item.num = jsonParam.pageNo*(resultMsg.data.list.length - i)
                         if(item.num < 10){
                            item.num = '0'+item.num
                         }
                         html+='<li class="myFlex tit_mar" ids="'+item.id+'">' +
                            '<span class="bg_lightgreen font_d health_num">'+item.num+'</span>' +
                            '<div class="data_plan">' +
                            '<div class="green font_e serialNum">脑卒中随访</div>' +
                            '<div class="font_s l_gray">随访日期：'+item.sfrq+'</div>' +
                            '</div>' +
                            '</li>'
                      })
                      getDetails(resultMsg.data.list[0].id)
                       $(".health_list").html(html)
                       $(".health_list li").eq(0).find(".serialNum").removeClass("a_gray").addClass("green");
                   }
                })
            };
            function getDetails(id) {
                var jsonParams = {
                    id : id,
                }
                getAjax('/health/follow/getNcz', jsonParams, function (resultMsg) {
                    var item = resultMsg.data
                    var html =''
                    html+='<div class="top_title">脑卒中随访</div>' +
                        '<div class="l_gray">随访日期：<span class="mar_r">'+item.followupdate+'</span><span class="green mar_r">随访方式：'+item.followupwayName+'</span>随访医生：'+item.followupdoctor+'</div>'
                    $(".top_box").html(html)
                    for (var i = 0;i < $('.consUl .sfz').length; i++) {
                        var ids = $('.consUl .sfz').eq(i).attr('id');
                        if(resultMsg.data !== undefined){
                            if(resultMsg.data[ids] != "" && resultMsg.data[ids]){
                                $('#' + ids).html(resultMsg.data[ids])
                            }else{
                                $('#' + ids).html("暂无数据")
                            }
                        }else{
                            $('#' + ids).html("暂无数据")
                        }
                    }
                    // var tableobj = {
                    //     elem: '#mqyyTable',
                    //     cellMinWidth: 80,
                    //     even: true,
                    //     cols: [[
                    //         {field:'ywmc', title: '药物名称',minWidth:100}
                    //         ,{field:'ywmcci', title: '用法',minWidth:100}
                    //         ,{field:'ywmcmg', title: '每次剂量(mg)',minWidth:100}
                    //     ]],
                    //     data: []
                    // };
                    // if(resultMsg.data.ywDtos){
                    //     tableobj.data = resultMsg.data.ywDtos;
                    // }
                    // table.render(tableobj);
                    var yaowu = ['ywmc1','ywmc2','ywmc3','qtyw'];
                    for (var j = 0; j < yaowu.length; j++) {
                        if (resultMsg.data[yaowu[j]] != '') {
                            $("#yaowutable tbody").append('<tr>' +
                                '<td>' + resultMsg.data[yaowu[j]] + '</td>' +
                                '<td>' + resultMsg.data[yaowu[j] + 'ci'] + '</td>' +
                                '<td>' + resultMsg.data[yaowu[j] + 'mg'] + '</td></tr>');
                        }
                    }
                    if ($("#yaowutable tbody").html() == '') {
                        $('.table-nodata').css('display', 'block');
                    } else {
                        $('.table-nodata').css('display', 'none');
                    }
                })
            }
        })
    })
</script>
</html>